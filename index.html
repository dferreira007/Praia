<!-- HTML: apenas o mural e personagens dentro da cena -->
<div class="person-group-beach">
  <div class="person-char p-jackson" data-name="Jackson"><div class="speech-bubble">0</div></div>
  <div class="person-char p-nathalia" data-name="Nathalia"><div class="speech-bubble">0</div></div>
  <div class="person-char p-diego" data-name="Diego"><div class="speech-bubble">0</div></div>
  <div class="person-char p-flavia" data-name="Flavia"><div class="speech-bubble">0</div></div>
  <div class="person-char p-otavio" data-name="Otavio"><div class="speech-bubble">0</div></div>
  <div class="person-char p-fernanda" data-name="Fernanda"><div class="speech-bubble">0</div></div>
</div>

<!-- Mural de mensagens animado -->
<div class="mural-floating" id="muralFloating"></div>

<script>
  const db = firebase.firestore();
  const muralFloating = document.getElementById('muralFloating');

  // Contador de boladas por personagem
  const characters = document.querySelectorAll('.person-char');
  const scoreMap = {};
  characters.forEach(c => {
    scoreMap[c.dataset.name] = 0;
    c.querySelector('.speech-bubble').textContent = 0;
  });

  // FunÃ§Ã£o para criar mensagem flutuante
  function createFloatingMessage(text, charElement=null) {
    const msgEl = document.createElement('div');
    msgEl.className = 'floating-message';
    msgEl.textContent = text;
    msgEl.style.left = charElement ? `${charElement.offsetLeft + 20}px` : `${Math.random()*80+10}%`;
    msgEl.style.bottom = charElement ? '100px' : '30px';
    msgEl.style.backgroundColor = ['#FFD700','#87CEEB','#FFB6C1'][Math.floor(Math.random()*3)];
    muralFloating.appendChild(msgEl);

    let pos = 0;
    const anim = setInterval(()=>{
      pos += 1;
      msgEl.style.bottom = parseInt(msgEl.style.bottom)+1+'px';
      msgEl.style.opacity = 1 - pos/100;
      if(pos>100){
        clearInterval(anim);
        msgEl.remove();
      }
    },20);
  }

  // Atualizar mural do Firebase em tempo real
  db.collection('messages').orderBy('createdAt', 'desc').limit(10)
    .onSnapshot(snapshot => {
      snapshot.forEach(doc => {
        const data = doc.data();
        createFloatingMessage(data.text);
      });
    });

  // FunÃ§Ã£o quando a bola acerta um personagem
  function hitCharacter(charElement){
    const name = charElement.dataset.name;
    scoreMap[name] += 10;
    charElement.querySelector('.speech-bubble').textContent = scoreMap[name];
    createFloatingMessage('ðŸ’¥', charElement);
    // Pode tocar som aqui: new Audio('splash.mp3').play();
  }

  // Exemplo: Integrar com o clique da bola
  scene.addEventListener('click', e=>{
    characters.forEach(c=>{
      const rect = c.getBoundingClientRect();
      if(e.clientX>=rect.left && e.clientX<=rect.right && e.clientY>=rect.top && e.clientY<=rect.bottom){
        hitCharacter(c);
      }
    });
  });

</script>

<style>
  .mural-floating{
    position:absolute;
    width:100%;
    height:100%;
    pointer-events:none;
    top:0; left:0;
    z-index:20;
  }

  .floating-message{
    position:absolute;
    padding:4px 10px;
    border-radius:12px;
    color:#fff;
    font-size:0.8em;
    opacity:1;
    white-space:nowrap;
    animation: floatUp 2s linear forwards;
  }

  @keyframes floatUp{
    from{transform:translateY(0);}
    to{transform:translateY(-100px); opacity:0;}
  }
</style>
